<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nathan">

<title>BIOPOLE - Chukchi Sea metatranscriptomics analysis report ‚Äì BIOPOLE Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sample-processing-sequencing-data-availability" id="toc-sample-processing-sequencing-data-availability" class="nav-link active" data-scroll-target="#sample-processing-sequencing-data-availability">üß™ Sample Processing, Sequencing &amp; Data Availability</a></li>
  <li><a href="#sequencing-output-cgr-qc-summary" id="toc-sequencing-output-cgr-qc-summary" class="nav-link" data-scroll-target="#sequencing-output-cgr-qc-summary">üìä Sequencing Output &amp; CGR QC Summary</a></li>
  <li><a href="#bioinformatics-workflow" id="toc-bioinformatics-workflow" class="nav-link" data-scroll-target="#bioinformatics-workflow">üß™ Bioinformatics Workflow</a>
  <ul class="collapse">
  <li><a href="#rrna-removal-sortmerna" id="toc-rrna-removal-sortmerna" class="nav-link" data-scroll-target="#rrna-removal-sortmerna">rRNA Removal ‚Äì <strong>SortMeRNA</strong></a></li>
  <li><a href="#de-novo-assembly-megahit" id="toc-de-novo-assembly-megahit" class="nav-link" data-scroll-target="#de-novo-assembly-megahit">De Novo Assembly ‚Äì <strong>MEGAHIT</strong></a></li>
  <li><a href="#read-mapping-bowtie2-and-samtools" id="toc-read-mapping-bowtie2-and-samtools" class="nav-link" data-scroll-target="#read-mapping-bowtie2-and-samtools">Read Mapping ‚Äì <strong>Bowtie2</strong> and <strong>Samtools</strong></a></li>
  <li><a href="#creating-anvio-databases" id="toc-creating-anvio-databases" class="nav-link" data-scroll-target="#creating-anvio-databases">Creating anvi‚Äôo Databases</a></li>
  <li><a href="#functional-annotation-of-genes" id="toc-functional-annotation-of-genes" class="nav-link" data-scroll-target="#functional-annotation-of-genes">üîç Functional Annotation of genes</a></li>
  <li><a href="#metabolic-reconstruction-and-pathway-visualisation" id="toc-metabolic-reconstruction-and-pathway-visualisation" class="nav-link" data-scroll-target="#metabolic-reconstruction-and-pathway-visualisation">üî¨ Metabolic Reconstruction and Pathway Visualisation</a></li>
  <li><a href="#kegg-module-m00529-denitrification-nitrate-nitrogen" id="toc-kegg-module-m00529-denitrification-nitrate-nitrogen" class="nav-link" data-scroll-target="#kegg-module-m00529-denitrification-nitrate-nitrogen">KEGG Module M00529 ‚Äî Denitrification (nitrate ‚Üí nitrogen)</a></li>
  <li><a href="#anvio-interactive-plot---denitrification---nitrate-reductase---station-1" id="toc-anvio-interactive-plot---denitrification---nitrate-reductase---station-1" class="nav-link" data-scroll-target="#anvio-interactive-plot---denitrification---nitrate-reductase---station-1">anvi‚Äôo interactive plot - Denitrification - Nitrate reductase - Station 1</a></li>
  <li><a href="#kegg-map-of-nitrogen-pathways" id="toc-kegg-map-of-nitrogen-pathways" class="nav-link" data-scroll-target="#kegg-map-of-nitrogen-pathways">KEGG Map of Nitrogen Pathways</a></li>
  <li><a href="#kegg-nitrogen-cycle-map00910" id="toc-kegg-nitrogen-cycle-map00910" class="nav-link" data-scroll-target="#kegg-nitrogen-cycle-map00910">KEGG nitrogen cycle (map00910)</a>
  <ul class="collapse">
  <li><a href="#core-nitrogen-cycle-kos-map00910" id="toc-core-nitrogen-cycle-kos-map00910" class="nav-link" data-scroll-target="#core-nitrogen-cycle-kos-map00910">Core nitrogen-cycle KOs (map00910)</a></li>
  </ul></li>
  <li><a href="#tara-oceans-arctic-data-as-reference" id="toc-tara-oceans-arctic-data-as-reference" class="nav-link" data-scroll-target="#tara-oceans-arctic-data-as-reference">Tara Oceans Arctic data as reference</a>
  <ul class="collapse">
  <li><a href="#rationale-and-overview" id="toc-rationale-and-overview" class="nav-link" data-scroll-target="#rationale-and-overview">Rationale and overview</a></li>
  <li><a href="#station-194---tara-oceans-polar-circle-expedition" id="toc-station-194---tara-oceans-polar-circle-expedition" class="nav-link" data-scroll-target="#station-194---tara-oceans-polar-circle-expedition">Station 194 - Tara Oceans Polar Circle expedition</a></li>
  <li><a href="#assembly-of-tara-oceans-arctic-metagenomes" id="toc-assembly-of-tara-oceans-arctic-metagenomes" class="nav-link" data-scroll-target="#assembly-of-tara-oceans-arctic-metagenomes">Assembly of Tara Oceans Arctic metagenomes</a></li>
  <li><a href="#metatranscriptomic-read-processing-and-mapping" id="toc-metatranscriptomic-read-processing-and-mapping" class="nav-link" data-scroll-target="#metatranscriptomic-read-processing-and-mapping">Metatranscriptomic read processing and mapping</a></li>
  </ul></li>
  <li><a href="#downloading-mags-from-station-194" id="toc-downloading-mags-from-station-194" class="nav-link" data-scroll-target="#downloading-mags-from-station-194">Downloading MAGs from Station 194</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">BIOPOLE - Chukchi Sea metatranscriptomics analysis report</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nathan </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<style>
pre code {
  background-color: #f2f2f2 !important;
  display: block;
  padding: 0.8em;
  border-radius: 6px;
}
code {
  background-color: #f2f2f2 !important;
  padding: 0.15em 0.35em;
  border-radius: 4px;
}
</style>
<p>This report summarises the bioinformatics workflow applied to the Chukchi Sea eRNA samples to study the Nitrogen cycles, particularly the denitrifcation and anammox metabolic pathways, using metatranscriptomics approach.</p>
<section id="sample-processing-sequencing-data-availability" class="level2">
<h2 class="anchored" data-anchor-id="sample-processing-sequencing-data-availability">üß™ Sample Processing, Sequencing &amp; Data Availability</h2>
<p>The Centre for Genomic Research (CGR) processed <strong>9 marine eRNA samples</strong> (+ 1 negative control) for metatranscriptomic sequencing as part of project <strong>SSP203072</strong>. The workflow included:</p>
<ul>
<li><p>DNase treatment of all extracted RNA samples.</p></li>
<li><p>rRNA depletion using the <em>Seawater riboPOOL</em> kit.</p></li>
<li><p>Construction of <strong>Illumina RNA-seq libraries</strong> from the rRNA-depleted material.</p></li>
</ul>
<p>Multiplexing of all libraries and sequencing on one lane of an <strong>Illumina NovaSeq X Plus</strong> (NovaSeq X+) 25B flow cell.</p>
<p>This setup is expected to produce approximately <strong>~325 million read pairs per sample</strong>, providing deep metatranscriptomic coverage suitable for resolving nitrogen-cycling pathways, including denitrification and anammox.</p>
<p><strong>Funding &amp; administrative details:</strong></p>
<ul>
<li><p><strong>SSP ID</strong>: SSP203072</p></li>
<li><p><strong>Platform</strong>: Illumina NovaSeq X+</p></li>
<li><p><strong>Funding</strong>: NEOF1819 ‚Äî Purchase Order P11212-200</p></li>
</ul>
<p>All files‚Äîincluding raw data, processing details, and download instructions‚Äîare available via:</p>
<p><a href="https://cgr.liv.ac.uk/illum/SSP203072_b7beb589a74e3e61/">Project data download</a></p>
</section>
<section id="sequencing-output-cgr-qc-summary" class="level2">
<h2 class="anchored" data-anchor-id="sequencing-output-cgr-qc-summary">üìä Sequencing Output &amp; CGR QC Summary</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 49%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 11%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Raw Reads (M)</th>
<th>Trimmed Reads (M)</th>
<th>Raw Bases (M)</th>
<th>Trimmed Bases (M)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1-S4S</td>
<td>422.03</td>
<td>418.30</td>
<td>126,608.75</td>
<td>120,507.35</td>
</tr>
<tr class="even">
<td>2-S4M</td>
<td>559.84</td>
<td>557.67</td>
<td>167,952.06</td>
<td>163,451.31</td>
</tr>
<tr class="odd">
<td>3-S4B</td>
<td>613.03</td>
<td>611.42</td>
<td>183,908.71</td>
<td>179,372.50</td>
</tr>
<tr class="even">
<td><span style="color:red;">4-S13S</span></td>
<td>9.89</td>
<td>7.81</td>
<td>2,968.42</td>
<td>2,244.11</td>
</tr>
<tr class="odd">
<td>5-S13M</td>
<td>240.41</td>
<td>238.67</td>
<td>72,124.26</td>
<td>70,520.45</td>
</tr>
<tr class="even">
<td>6-S13B</td>
<td>617.78</td>
<td>615.94</td>
<td>185,334.01</td>
<td>181,063.09</td>
</tr>
<tr class="odd">
<td>7-S14S</td>
<td>526.76</td>
<td>524.35</td>
<td>158,026.71</td>
<td>153,976.49</td>
</tr>
<tr class="even">
<td>8-S14M</td>
<td>526.33</td>
<td>524.19</td>
<td>157,899.00</td>
<td>153,074.61</td>
</tr>
<tr class="odd">
<td>9-S14B</td>
<td>571.17</td>
<td>569.59</td>
<td>171,349.89</td>
<td>166,325.31</td>
</tr>
<tr class="even">
<td><span style="color:red;">10-negative_control</span></td>
<td>5.92</td>
<td>5.16</td>
<td>1,776.58</td>
<td>1,487.48</td>
</tr>
</tbody>
</table>
<p><strong>Description of Methods</strong> The raw FASTQ files are trimmed for the presence of Illumina adapter sequences using Cutadapt version 4.5 . The option -O 3 was used, meaning that trimming occurred in reads where at least 3bp of adapter sequence was observed at the 3‚Äô end of the read. The reads were further trimmed to remove low quality bases with a minimum window quality score of 20. After trimming, reads shorter than 15 bp were removed. Only read pairs are retained, therefore if a read of a pair is trimmed away then the other read in the pair is also discarded.</p>
<div class="callout callout-style-default callout-note callout-titled" title="üìù Notes on Low-Yield Samples">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>üìù Notes on Low-Yield Samples
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>4-S13S</strong> returned an exceptionally low number of reads because very little RNA was recovered from the corresponding Sterivex filters. This limited input material resulted in poor library complexity and low overall sequencing yield.</p>
<p><strong>10-negative_control</strong> is a processing negative control sample and therefore contains no biological RNA. The very low read count is expected and confirms that minimal contamination occurred during library preparation.</p>
</div>
</div>
</section>
<section id="bioinformatics-workflow" class="level1">
<h1>üß™ Bioinformatics Workflow</h1>
<section id="rrna-removal-sortmerna" class="level2">
<h2 class="anchored" data-anchor-id="rrna-removal-sortmerna">rRNA Removal ‚Äì <strong>SortMeRNA</strong></h2>
<p>To enrich for mRNA and other non-rRNA transcripts, we removed ribosomal RNA using <strong>SortMeRNA</strong>.</p>
<p>The command below shows the SortMeRNA run that was used for each sample. We used the CGR-trimmed paired-end reads as input and the <strong>smr_v4.3_sensitive_db_rfam_seeds</strong> database for rRNA identification.</p>
<pre class="{bash}"><code>
sortmerna \
  --ref "smr_v4.3_sensitive_db_rfam_seeds.fasta" \
  --reads "$R1" \
  --reads "$R2" \
  --threads "$SLURM_CPUS_PER_TASK" \
  --fastx \
  --out2 \
  --paired_in \
  --aligned "${SAMPLE}_rRNA" \
  --other "${SAMPLE}_RNA_clean" \
  --workdir "$WORKDIR"</code></pre>
<p>For each sample, SortMeRNA produces:</p>
<p><em><em>rRNA</em></em> files containing reads classified as rRNA</p>
<p><em><em>RNA_clean</em></em> files containing the rRNA-depleted read pairs, which are carried forward to assembly.</p>
</section>
<section id="de-novo-assembly-megahit" class="level2">
<h2 class="anchored" data-anchor-id="de-novo-assembly-megahit">De Novo Assembly ‚Äì <strong>MEGAHIT</strong></h2>
<p>We performed a co-assembly of selected rRNA-depleted samples using MEGAHIT, optimised for complex metatranscriptomic data with the meta-sensitive preset. For illustration, the command below shows the co-assembly of samples:</p>
<pre class="{bash}"><code>megahit 
-1 [station_samples]_RNA_clean_fwd.fq.gz 
-2 [station_samples]_RNA_clean_rev.fq.gz 
-t 60 
--presets meta-sensitive 
--min-contig-len 500 
-m 0.9 
-o St[1:3]_megahit_out</code></pre>
<p>Assembly statistics for an example MEGAHIT run (St1) were obtained using seqkit:</p>
<pre class="{bash}"><code>seqkit stats final.contigs.fa</code></pre>
<p>For example (St1 assembly):</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 10%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 17%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Assembly</th>
<th># Contigs</th>
<th>Total Length (bp)</th>
<th>Min Length (bp)</th>
<th>Mean Length (bp)</th>
<th>Max Length (bp)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>final.contigs.fa</code></td>
<td>1,432,902</td>
<td>1,457,453,119</td>
<td>500</td>
<td>1,017.1</td>
<td>106,426</td>
</tr>
</tbody>
</table>
<p>These statistics indicate a highly fragmented but deep assembly, typical of complex marine microbial metatranscriptomes, with contigs ‚â•500 bp retained for downstream analyses.</p>
</section>
<section id="read-mapping-bowtie2-and-samtools" class="level2">
<h2 class="anchored" data-anchor-id="read-mapping-bowtie2-and-samtools">Read Mapping ‚Äì <strong>Bowtie2</strong> and <strong>Samtools</strong></h2>
<p>To quantify transcript coverage across assembled contigs, we mapped the rRNA-depleted reads back to the MEGAHIT assembly using Bowtie2, followed by BAM processing with Samtools.</p>
<p>First, we built a Bowtie2 index from the fixed assembly:</p>
<pre class="{bash}"><code>bowtie2-build St1_assembly-fixed.fa St1_assembly-fixed</code></pre>
<p>Then, for each sample, paired-end reads were aligned and processed as follows:</p>
<pre class="{bash}"><code>IDX="St1_assembly-fixed"
R1="SAMPLE_RNA_clean_fwd.fq.gz"
R2="SAMPLE_RNA_clean_rev.fq.gz"
THREADS=16
OUT="St1_SAMPLE"

Map paired-end reads

bowtie2 -x "${IDX}"
-1 "${R1}"
-2 "${R2}"
-p "${THREADS}"
-S "${OUT}.sam"

Convert to BAM, keep mapped reads only (-F 4), sort and index

samtools view -F 4 -bS "${OUT}.sam" -o "${OUT}-RAW.bam"
samtools sort -@ "${THREADS}" "${OUT}-RAW.bam" -o "${OUT}.bam"
samtools index "${OUT}.bam"</code></pre>
<p>The resulting sorted and indexed BAM files (<em>.bam, </em>.bam.bai) are used as input for downstream coverage estimation and gene- or contig-level quantification in anvi‚Äôo.</p>
</section>
<section id="creating-anvio-databases" class="level2">
<h2 class="anchored" data-anchor-id="creating-anvio-databases">Creating anvi‚Äôo Databases</h2>
<p>Subsequent steps involved importing the assemblies and mapped reads into anvi‚Äôo to facilitate contig profiling, annotation, and interactive exploration of nitrogen-cycle genes (e.g.&nbsp;denitrification and anammox pathways).</p>
<p>In brief, the workflow included:</p>
<ol type="1">
<li><p>Creating a contigs database from the MEGAHIT assembly</p></li>
<li><p>Running HMMs and functional annotation (e.g.&nbsp;PFAM, TIGRFAMs, KOfam)</p></li>
<li><p>Profiling BAM files for each sample to obtain coverage and detection statistics</p></li>
<li><p>Merging profiles across samples for joint inspection and downstream analyses</p></li>
</ol>
<p>Example (commands will vary slightly depending on environment and anvio version):</p>
<ol type="1">
<li>Create contigs database</li>
</ol>
<pre class="{bash}"><code>anvi-gen-contigs-database -f St1_assembly-fixed.fa -o St1_contigs.db -n "St1 Chukchi Sea metaT"</code></pre>
<ol start="2" type="1">
<li>Run HMMs (standard anvio collection)</li>
</ol>
<pre class="{bash}"><code>anvi-run-hmms -c St1_contigs.db --num-threads 20</code></pre>
<ol start="3" type="1">
<li>Profile each BAM file</li>
</ol>
<pre class="{bash}"><code>anvi-profile -i St1_SAMPLE.bam -c St1_contigs.db
--output-dir St1_SAMPLE_profile
--num-threads 20</code></pre>
<ol start="4" type="1">
<li>Merge profiles across samples</li>
</ol>
<pre class="{bash}"><code>anvi-merge St1_*_profile/PROFILE.db -o St1_merged_profiles -c St1_contigs.db</code></pre>
<p>These anvi‚Äôo databases form the basis for functional annotation and visualisation of key nitrogen-cycle pathways in the Chukchi Sea metatranscriptomes.</p>
</section>
<section id="functional-annotation-of-genes" class="level2">
<h2 class="anchored" data-anchor-id="functional-annotation-of-genes">üîç Functional Annotation of genes</h2>
<p>To characterise the metabolic potential represented in the metatranscriptomic assembly, we performed extensive functional annotation of the anvi‚Äôo contigs database. This step links assembled sequences to known protein families, orthologous groups, and taxonomic markers, enabling downstream interpretation of nitrogen-cycle genes (e.g., denitrification, anammox).</p>
<p>We used the following anvi‚Äôo annotation programs:</p>
<pre class="{bash}"><code>anvi-run-hmms</code></pre>
<p>Identifies single-copy core genes (SCGs) and key conserved protein families using anvi‚Äôo‚Äôs curated HMM collections. This provides quality metrics for assemblies and forms the basis for taxonomic inference.</p>
<pre class="{bash}"><code>anvi-run-ncbi-cogs</code></pre>
<p>Assigns Clusters of Orthologous Groups (COGs) from NCBI to contigs based on predicted open reading frames. COG categories help identify broad functional roles such as energy production, amino acid metabolism, stress response, etc.</p>
<pre class="{bash}"><code>anvi-run-kegg-kofams</code></pre>
<p>Annotates genes using KEGG Orthologs (KOfam HMMs), providing pathway-level information including nitrogen cycling modules (e.g., nitrate reduction, nitrification, denitrification, anammox).</p>
<pre class="{bash}"><code>anvi-run-scg-taxonomy</code></pre>
<p>Uses single-copy core gene content to infer taxonomic origin of contigs, giving insight into which microbial groups are contributing to specific nitrogen-cycling pathways.</p>
</section>
<section id="metabolic-reconstruction-and-pathway-visualisation" class="level2">
<h2 class="anchored" data-anchor-id="metabolic-reconstruction-and-pathway-visualisation">üî¨ Metabolic Reconstruction and Pathway Visualisation</h2>
<p>Following functional annotation, we performed metabolic inference and pathway-level analysis using anvi‚Äôo‚Äôs metabolism suite. These tools integrate KEGG Ortholog (KOfam) annotations with curated pathway models to identify which biochemical pathways are represented in the dataset and to visualise how transcripts map onto specific metabolic processes‚Äîparticularly those involved in nitrogen cycling.</p>
<p>We used the following anvi‚Äôo programs:</p>
<pre class="{bash}"><code>anvi-estimate-metabolism</code></pre>
<p>Identifies complete and partial KEGG modules across all annotated contigs, providing an overview of metabolic potential (e.g., denitrification, dissimilatory nitrate reduction, anammox).</p>
<pre class="{bash}"><code>anvi-reaction-network</code></pre>
<p>Generates reaction-centric metabolic networks based on KEGG reactions detected in the assembly. This allows exploration of how individual reactions connect into broader nitrogen pathways.</p>
<pre class="{bash}"><code>anvi-draw-kegg</code></pre>
<p>Renders KEGG metabolic pathway diagrams annotated with detected genes, enabling visual inspection of pathway completeness and highlighting which steps are supported by metatranscriptomic evidence.</p>
<p>These tools collectively provide a pathway-level view of nitrogen cycling activity in the Chukchi Sea microbial community, enabling detailed interpretation of expression patterns associated with denitrification, nitrification, and anammox processes.</p>
</section>
<section id="kegg-module-m00529-denitrification-nitrate-nitrogen" class="level2">
<h2 class="anchored" data-anchor-id="kegg-module-m00529-denitrification-nitrate-nitrogen">KEGG Module M00529 ‚Äî Denitrification (nitrate ‚Üí nitrogen)</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/KEGG_Module_Denitrification_M00529.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption>KEGG module M00529 (Denitrification, nitrate ‚Üí nitrogen). Diagram from https://www.genome.jp/dbget-bin/www_bget?md:M00529</figcaption>
</figure>
</div>
<p>From the output of anvi-estimate-metabolism, we can look for the KEGG module for Denitrification (M00529) and look at its completeness:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 22%">
<col style="width: 28%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>KEGG Module</th>
<th>Station</th>
<th>stepwise_module_completeness</th>
<th>pathwise_module_completeness</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>M00529</td>
<td>Station_1</td>
<td>1.00</td>
<td>1.00</td>
</tr>
<tr class="even">
<td>M00529</td>
<td>Station_2</td>
<td>1.00</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td>M00529</td>
<td>Station_3</td>
<td>1.00</td>
<td>1.00</td>
</tr>
</tbody>
</table>
<p>So all the genes required for denitrification to occur seem to be detected at each of the stations.</p>
<p>Let‚Äôs look at the denitrification pathway in more details using anvi-interactive, so we can see the coverage of the genes involved in denitrification across the 3 depths in the stations.</p>
<p>First, we need to create an anvi‚Äôo collection that contains all the denitrification genes. Using <strong>anvi-export-functions</strong> we can get the <em>gene_callers_ids</em> matching your <em>KO IDs</em>, then we can get the contigs name using <strong>anvi-export-table ‚Äìtable genes_in_contigs</strong>. After that we need to use <em>join</em> to find the contigs that have the genes of interest and finally we need to add ‚Äú_split_00001‚Äù to each contig name (because in this case each contig has only one split as these come from metaT assembly. We ad a column with the name of our bin and then can import that using <strong>anvi-import-collection</strong></p>
<pre class="{bash}"><code>anvi-export-functions   -c St1_contigs.db   -o St1_gene_functions.tsv
anvi-export-table --table genes_in_contigs -o St1_genes_in_contigs.tsv St1_contigs.db
tail -n +2 St1_genes_in_contigs.tsv | cut -f1,2 &gt; gene_to_contig.tsv

# KO list for denitrification (edit/add as needed)
KOS='K00370|K00371|K00374|K02567|K02568|K00368|K15864|K04561|K02305|K00376'
# Get unique gene_callers_id hits for those KOs
awk -F'\t' -v kos="$KOS" '($3 ~ kos){print $1}' St1_gene_functions.tsv   | sort -u &gt; genes_of_interest.ids
join -t $'\t' genes_of_interest.ids gene_to_contig.tsv   | cut -f2   | sort -u &gt; contigs_of_interest.txt
awk '{print $1"_split_00001\tdenitrification"}' contigs_of_interest.txt   &gt; denitrification_splits_collection.tsv

anvi-import-collection   -p St1_MERGED/PROFILE.db   -c St1_contigs.db   -C denitrification_splits denitrification_splits_collection.tsv</code></pre>
<p>Now that we have an anvio collection, we need to ‚Äúsplit‚Äù it from the main contigs and profile databases (we create a subset). This is because our initial contigs.be has too many splits (1,432,906 splits to be precise) and hierarchical clustering gets turned off.</p>
<p>Once it is splitted we can find a directory called ‚Äúdenitrifications_splits‚Äù in which we find a contigs and profile database that we can now plot using anvi-interactive.</p>
<p>First, we will import the data about the presence/absence of the genes of interest (from Module M00529) so we can visualise where they are found.</p>
<pre class="{bash}"><code>anvi-export-functions   -c CONTIGS.db   -o gene_functions.tsv

# 1) Define your KO list (space-separated)
KOS="K00370 K00371 K00374 K02567 K02568 K00368 K15864 K04561 K02305 K00376"

# 2) Build gene-level KO presence/absence from gene_functions.tsv (KO is column 3)
awk -F'\t' -v OFS='\t' -v kos="$KOS" '
BEGIN{
    n = split(kos, k, " ")
    for (i=1; i&lt;=n; i++) KO[k[i]] = 1
    printf "gene_callers_id"
    for (i=1; i&lt;=n; i++) printf "%s%s", OFS, k[i]
    printf "\n"
}
NR==1 { next }  # skip header
{
    gene = $1
    acc  = $3
    genes[gene] = 1
    if (acc in KO) present[gene, acc] = 1
}
END{
    for (g in genes) {
        printf "%s", g
        for (i=1; i&lt;=n; i++) {
            ko = k[i]
            v = ((g SUBSEP ko) in present) ? 1 : 0
            printf "%s%d", OFS, v
        }
        printf "\n"
    }
}
' gene_functions.tsv &gt; KO_presence_absence_by_gene.tsv

# 3) Map gene_callers_id -&gt; contig (requires genes_in_contigs.tsv from anvi-export-gene-calls)
#    Then collapse to contig-level by OR (max) across genes
awk -F'\t' -v OFS='\t' '
NR==FNR {
    if (FNR==1) next
    gene2contig[$1] = $2
    next
}
FNR==1 { print "contig", substr($0, index($0, "\t")+1); ncol=NF; next }
{
    gene = $1
    contig = (gene in gene2contig) ? gene2contig[gene] : "NA"
    contigs[contig]=1
    for (i=2; i&lt;=NF; i++) if ($i==1) M[contig, i]=1
}
END{
    for (c in contigs) {
        printf "%s", c
        for (i=2; i&lt;=ncol; i++) {
            v = ((c SUBSEP i) in M) ? 1 : 0
            printf "%s%d", OFS, v
        }
        printf "\n"
    }
}
' genes_in_contigs.tsv KO_presence_absence_by_gene.tsv &gt; KO_presence_absence_by_contig.tsv

# 4) Convert contig names to split names (naive: appends _split_00001)
awk -F'\t' -v OFS='\t' '
FNR==1 { $1="item_name"; print; next }
{ $1 = $1 "_split_00001"; print }
' KO_presence_absence_by_contig.tsv &gt; KO_presence_absence_by_split.tsv

# Import the data to the PROFILE.db
anvi-import-misc-data -p PROFILE.db -t items KO_presence_absence_by_split.tsv
</code></pre>
</section>
<section id="anvio-interactive-plot---denitrification---nitrate-reductase---station-1" class="level2">
<h2 class="anchored" data-anchor-id="anvio-interactive-plot---denitrification---nitrate-reductase---station-1">anvi‚Äôo interactive plot - Denitrification - Nitrate reductase - Station 1</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/anvi_plot_denitrification_KOs_presence-absence.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Anvi‚Äôo interactive plot showing the presence/absence of transcript annotation associated with denitrification in station 1.</figcaption>
</figure>
</div>
<p>From this plot we see that:</p>
<ol type="1">
<li><p>K00370 (narG) and K00371 (narH) are annotated on the same transcript (bin 1 on figure) which makes sense as they are subunits of the same nitrate reductase enzyme complex. In many bacterial genomes, narG and narH are directly adjacent and commonly co-transcribed as part of a nitrate reductase operon. For example, in E. coli the nar operon appears to contain four genes designated narGHJI (<a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC211023/pdf/jbacter00182-0317.pdf" class="uri">https://pmc.ncbi.nlm.nih.gov/articles/PMC211023/pdf/jbacter00182-0317.pdf</a>).Operons are typically transcribed as one long mRNA. Hence, having multiple functions on one transcript here is not surprising.</p></li>
<li><p>Transcripts are annotated with the same gene multiple times. Different microbial populations likely have slightly different sequences for these genes, hence they get assembled into multiple different versions instead of collapsed by the assembler into one sequence. Hence, having multiple transcript with the same function is not surprising.</p></li>
</ol>
<p>From the coverage data layers, we can see that all the transcripts have coverage from sample S4B (Bottom) ans most for sample S4M (Mid-water) but some might be missing from sample S4S (Surface). Therefore, let‚Äôs look at the completeness of denitrification per depth instead of for the whole station.</p>
<pre class="{bash}"><code>anvi-estimate-metabolism -c CONTIGS.db -p PROFILE.db -O denitrification_meta --add-coverage</code></pre>
<p>From the output table we see that, the denitrification module (M00529) shows differences in both abundance (average coverage) and completeness (average detection) across samples. St1_S4S exhibits substantially lower coverage and detection, indicating a reduced presence and/or partial representation of the denitrification pathway in the surface sample. In contrast, St1_S4M and St1_S4B show much higher coverage and detection values, consistent with a more abundant and more complete denitrification potential in deeper waters. Notably, St1_S4B shows the highest detection, suggesting the most complete representation of the pathway among the three samples. Given that denitrification is surely happening in the sediments, this result makes sense.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Sample</th>
<th>Avg. Coverage</th>
<th>Avg. Detection</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>St1_S4S</td>
<td>975.53</td>
<td>0.454</td>
</tr>
<tr class="even">
<td>St1_S4M</td>
<td>2032.39</td>
<td>0.787</td>
</tr>
<tr class="odd">
<td>St1_S4B</td>
<td>1706.59</td>
<td>0.859</td>
</tr>
</tbody>
</table>
<p>The table below provides a gene-level breakdown of the denitrification module (KEGG M00529), linking each predicted gene (Gene_ID) to its corresponding KEGG Ortholog (KO) and its sequencing coverage in three samples (St1_S4B, St1_S4M, and St1_S4S).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 5%">
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Gene_ID</th>
<th>KO</th>
<th style="text-align: right;">St1_S4B_coverage</th>
<th style="text-align: right;">St1_S4M_coverage</th>
<th style="text-align: right;">St1_S4S_coverage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1359363</td>
<td>K00368</td>
<td style="text-align: right;">20.2724</td>
<td style="text-align: right;">20.0305</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">691166</td>
<td>K00368</td>
<td style="text-align: right;">165.5046</td>
<td style="text-align: right;">334.5195</td>
<td style="text-align: right;">13.3177</td>
</tr>
<tr class="odd">
<td style="text-align: right;">707695</td>
<td>K00368</td>
<td style="text-align: right;">41.8570</td>
<td style="text-align: right;">69.1358</td>
<td style="text-align: right;">12.5575</td>
</tr>
<tr class="even">
<td style="text-align: right;">687620</td>
<td>K00368</td>
<td style="text-align: right;">1282.9247</td>
<td style="text-align: right;">2415.3629</td>
<td style="text-align: right;">243.7858</td>
</tr>
<tr class="odd">
<td style="text-align: right;">700737</td>
<td>K00368</td>
<td style="text-align: right;">2478.6866</td>
<td style="text-align: right;">2384.1486</td>
<td style="text-align: right;">1253.8170</td>
</tr>
<tr class="even">
<td style="text-align: right;">854256</td>
<td>K00368</td>
<td style="text-align: right;">11.4167</td>
<td style="text-align: right;">3.3309</td>
<td style="text-align: right;">5.3478</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1185346</td>
<td>K00368</td>
<td style="text-align: right;">28.9579</td>
<td style="text-align: right;">5.8295</td>
<td style="text-align: right;">7.4308</td>
</tr>
<tr class="even">
<td style="text-align: right;">941749</td>
<td>K00368</td>
<td style="text-align: right;">38.1338</td>
<td style="text-align: right;">27.6934</td>
<td style="text-align: right;">5.3577</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1709903</td>
<td>K00368</td>
<td style="text-align: right;">105.2276</td>
<td style="text-align: right;">88.9237</td>
<td style="text-align: right;">34.8610</td>
</tr>
<tr class="even">
<td style="text-align: right;">1705673</td>
<td>K00368</td>
<td style="text-align: right;">344.4583</td>
<td style="text-align: right;">682.0183</td>
<td style="text-align: right;">178.3852</td>
</tr>
<tr class="odd">
<td style="text-align: right;">65438</td>
<td>K00368</td>
<td style="text-align: right;">6.3643</td>
<td style="text-align: right;">5.1628</td>
<td style="text-align: right;">6.0814</td>
</tr>
<tr class="even">
<td style="text-align: right;">1031617</td>
<td>K00368</td>
<td style="text-align: right;">689.8963</td>
<td style="text-align: right;">1204.7898</td>
<td style="text-align: right;">165.6266</td>
</tr>
<tr class="odd">
<td style="text-align: right;">26013</td>
<td>K00368</td>
<td style="text-align: right;">12.4952</td>
<td style="text-align: right;">12.8188</td>
<td style="text-align: right;">15.1860</td>
</tr>
<tr class="even">
<td style="text-align: right;">1787639</td>
<td>K00368</td>
<td style="text-align: right;">9.6738</td>
<td style="text-align: right;">18.6717</td>
<td style="text-align: right;">17.9031</td>
</tr>
<tr class="odd">
<td style="text-align: right;">888296</td>
<td>K00368</td>
<td style="text-align: right;">40.1019</td>
<td style="text-align: right;">45.6324</td>
<td style="text-align: right;">5.3630</td>
</tr>
<tr class="even">
<td style="text-align: right;">895831</td>
<td>K00368</td>
<td style="text-align: right;">49445.2245</td>
<td style="text-align: right;">52866.8920</td>
<td style="text-align: right;">44637.3724</td>
</tr>
<tr class="odd">
<td style="text-align: right;">882932</td>
<td>K00368</td>
<td style="text-align: right;">14.2161</td>
<td style="text-align: right;">18.0897</td>
<td style="text-align: right;">8.2637</td>
</tr>
<tr class="even">
<td style="text-align: right;">87959</td>
<td>K00368</td>
<td style="text-align: right;">10915.1630</td>
<td style="text-align: right;">11415.0249</td>
<td style="text-align: right;">4717.4411</td>
</tr>
<tr class="odd">
<td style="text-align: right;">994614</td>
<td>K00368</td>
<td style="text-align: right;">1.9337</td>
<td style="text-align: right;">17.4825</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">1617538</td>
<td>K00368</td>
<td style="text-align: right;">14.7141</td>
<td style="text-align: right;">12.2627</td>
<td style="text-align: right;">18.9873</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1348289</td>
<td>K00368</td>
<td style="text-align: right;">19.2252</td>
<td style="text-align: right;">17.7117</td>
<td style="text-align: right;">3.4054</td>
</tr>
<tr class="even">
<td style="text-align: right;">411974</td>
<td>K00368</td>
<td style="text-align: right;">12.5977</td>
<td style="text-align: right;">27.5419</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">441287</td>
<td>K00368</td>
<td style="text-align: right;">145.1941</td>
<td style="text-align: right;">279.3881</td>
<td style="text-align: right;">10.4268</td>
</tr>
<tr class="even">
<td style="text-align: right;">516928</td>
<td>K00368</td>
<td style="text-align: right;">14.6225</td>
<td style="text-align: right;">4.1400</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19512</td>
<td>K00368</td>
<td style="text-align: right;">9.0578</td>
<td style="text-align: right;">9.2244</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">189833</td>
<td>K00368</td>
<td style="text-align: right;">16223.0362</td>
<td style="text-align: right;">32930.3351</td>
<td style="text-align: right;">3152.7518</td>
</tr>
<tr class="odd">
<td style="text-align: right;">443514</td>
<td>K00368</td>
<td style="text-align: right;">34.8817</td>
<td style="text-align: right;">66.0895</td>
<td style="text-align: right;">4.2496</td>
</tr>
<tr class="even">
<td style="text-align: right;">823538</td>
<td>K00368</td>
<td style="text-align: right;">935.0735</td>
<td style="text-align: right;">1874.6680</td>
<td style="text-align: right;">392.6050</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1814075</td>
<td>K00368</td>
<td style="text-align: right;">69.7314</td>
<td style="text-align: right;">164.8157</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">742645</td>
<td>K00370</td>
<td style="text-align: right;">878.6661</td>
<td style="text-align: right;">1009.9220</td>
<td style="text-align: right;">251.1167</td>
</tr>
<tr class="odd">
<td style="text-align: right;">594150</td>
<td>K00371</td>
<td style="text-align: right;">2.4505</td>
<td style="text-align: right;">14.2871</td>
<td style="text-align: right;">6.3498</td>
</tr>
<tr class="even">
<td style="text-align: right;">1363937</td>
<td>K00371</td>
<td style="text-align: right;">10.2119</td>
<td style="text-align: right;">3.3420</td>
<td style="text-align: right;">16.6811</td>
</tr>
<tr class="odd">
<td style="text-align: right;">815415</td>
<td>K00371</td>
<td style="text-align: right;">0.7502</td>
<td style="text-align: right;">9.2725</td>
<td style="text-align: right;">26.9735</td>
</tr>
<tr class="even">
<td style="text-align: right;">85995</td>
<td>K00371</td>
<td style="text-align: right;">7687.8341</td>
<td style="text-align: right;">7547.8975</td>
<td style="text-align: right;">2080.3177</td>
</tr>
<tr class="odd">
<td style="text-align: right;">144516</td>
<td>K00371</td>
<td style="text-align: right;">55.7631</td>
<td style="text-align: right;">69.1036</td>
<td style="text-align: right;">41.3231</td>
</tr>
<tr class="even">
<td style="text-align: right;">433983</td>
<td>K00371</td>
<td style="text-align: right;">8190.7754</td>
<td style="text-align: right;">7206.5446</td>
<td style="text-align: right;">2536.7527</td>
</tr>
<tr class="odd">
<td style="text-align: right;">528599</td>
<td>K00371</td>
<td style="text-align: right;">1780.6823</td>
<td style="text-align: right;">1350.2175</td>
<td style="text-align: right;">893.7160</td>
</tr>
<tr class="even">
<td style="text-align: right;">742644</td>
<td>K00371</td>
<td style="text-align: right;">691.1526</td>
<td style="text-align: right;">522.5736</td>
<td style="text-align: right;">229.5579</td>
</tr>
<tr class="odd">
<td style="text-align: right;">772410</td>
<td>K00371</td>
<td style="text-align: right;">12746.2707</td>
<td style="text-align: right;">12521.7199</td>
<td style="text-align: right;">4925.9703</td>
</tr>
<tr class="even">
<td style="text-align: right;">894284</td>
<td>K00371</td>
<td style="text-align: right;">523.0258</td>
<td style="text-align: right;">645.8185</td>
<td style="text-align: right;">215.0751</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1228756</td>
<td>K00371</td>
<td style="text-align: right;">78.4240</td>
<td style="text-align: right;">116.4395</td>
<td style="text-align: right;">19.8915</td>
</tr>
<tr class="even">
<td style="text-align: right;">747852</td>
<td>K00374</td>
<td style="text-align: right;">17.9413</td>
<td style="text-align: right;">5.8443</td>
<td style="text-align: right;">32.5668</td>
</tr>
<tr class="odd">
<td style="text-align: right;">123437</td>
<td>K00374</td>
<td style="text-align: right;">4.6273</td>
<td style="text-align: right;">7.1632</td>
<td style="text-align: right;">29.0478</td>
</tr>
<tr class="even">
<td style="text-align: right;">815414</td>
<td>K00374</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">8.0645</td>
<td style="text-align: right;">24.4382</td>
</tr>
<tr class="odd">
<td style="text-align: right;">474316</td>
<td>K00374</td>
<td style="text-align: right;">1.3157</td>
<td style="text-align: right;">6.2746</td>
<td style="text-align: right;">3.1953</td>
</tr>
<tr class="even">
<td style="text-align: right;">123436</td>
<td>K00374</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">4.4774</td>
<td style="text-align: right;">18.0989</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1743784</td>
<td>K00376</td>
<td style="text-align: right;">11.0827</td>
<td style="text-align: right;">4.6706</td>
<td style="text-align: right;">1.3333</td>
</tr>
<tr class="even">
<td style="text-align: right;">296938</td>
<td>K00376</td>
<td style="text-align: right;">23.3961</td>
<td style="text-align: right;">8.4638</td>
<td style="text-align: right;">4.3466</td>
</tr>
<tr class="odd">
<td style="text-align: right;">239047</td>
<td>K00376</td>
<td style="text-align: right;">16.0931</td>
<td style="text-align: right;">8.2598</td>
<td style="text-align: right;">3.6313</td>
</tr>
<tr class="even">
<td style="text-align: right;">110498</td>
<td>K00376</td>
<td style="text-align: right;">5.2941</td>
<td style="text-align: right;">8.1390</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">374090</td>
<td>K00376</td>
<td style="text-align: right;">9.8702</td>
<td style="text-align: right;">1.9231</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">793456</td>
<td>K00376</td>
<td style="text-align: right;">8.9385</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">921128</td>
<td>K00376</td>
<td style="text-align: right;">9.3483</td>
<td style="text-align: right;">4.0896</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">1401364</td>
<td>K02305</td>
<td style="text-align: right;">8.4604</td>
<td style="text-align: right;">3.2278</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1445710</td>
<td>K02305</td>
<td style="text-align: right;">14.9201</td>
<td style="text-align: right;">16.6901</td>
<td style="text-align: right;">2.8947</td>
</tr>
<tr class="even">
<td style="text-align: right;">1753152</td>
<td>K02567</td>
<td style="text-align: right;">11.9600</td>
<td style="text-align: right;">9.6693</td>
<td style="text-align: right;">4.4833</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1433084</td>
<td>K02567</td>
<td style="text-align: right;">12.6263</td>
<td style="text-align: right;">2.1465</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">1852908</td>
<td>K02567</td>
<td style="text-align: right;">4.2483</td>
<td style="text-align: right;">2.2242</td>
<td style="text-align: right;">20.1092</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1168575</td>
<td>K02568</td>
<td style="text-align: right;">5.9083</td>
<td style="text-align: right;">11.0201</td>
<td style="text-align: right;">1.5839</td>
</tr>
<tr class="even">
<td style="text-align: right;">648640</td>
<td>K02568</td>
<td style="text-align: right;">5.2407</td>
<td style="text-align: right;">2.0864</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1431702</td>
<td>K02568</td>
<td style="text-align: right;">7.0235</td>
<td style="text-align: right;">4.4507</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">481953</td>
<td>K02568</td>
<td style="text-align: right;">18.7030</td>
<td style="text-align: right;">19.8397</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">685198</td>
<td>K04561</td>
<td style="text-align: right;">17.1011</td>
<td style="text-align: right;">0.2232</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">1271679</td>
<td>K04561</td>
<td style="text-align: right;">11.4956</td>
<td style="text-align: right;">3.5383</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">468297</td>
<td>K04561</td>
<td style="text-align: right;">11.6298</td>
<td style="text-align: right;">5.9309</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: right;">252981</td>
<td>K04561</td>
<td style="text-align: right;">21.7907</td>
<td style="text-align: right;">1.7374</td>
<td style="text-align: right;">29.5610</td>
</tr>
<tr class="odd">
<td style="text-align: right;">540786</td>
<td>K04561</td>
<td style="text-align: right;">3.4200</td>
<td style="text-align: right;">7.7399</td>
<td style="text-align: right;">0.7168</td>
</tr>
<tr class="even">
<td style="text-align: right;">1468402</td>
<td>K15864</td>
<td style="text-align: right;">9.0891</td>
<td style="text-align: right;">5.8108</td>
<td style="text-align: right;">5.5743</td>
</tr>
</tbody>
</table>
<p>Multiple gene copies are associated with several key denitrification steps, indicating some degree of functional redundancy within the pathway. Gene coverages are generally higher in St1_S4B and St1_S4M than in St1_S4S, where several components show low or zero coverage, suggesting a reduced or incomplete representation of the pathway in this sample. A small number of genes display particularly high coverage, implying that certain denitrification functions may be more prevalent than others across the dataset.</p>
<p>Now using the table above, we can list for each sample the Gene_IDs and KOs with nonzero coverage and you can turn that list into into an enzymes-txt file which can be used to calculated the denitrification completeness score for each sample, using:</p>
<pre class="{bash}"><code>anvi-estimate-metabolism --enzymes-txt</code></pre>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 24%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Sample</th>
<th>Module</th>
<th>Stepwise completeness</th>
<th>Pathwise completeness</th>
<th>Proportion of unique enzymes present</th>
<th>Enzymes unique to module</th>
<th>Unique enzyme hit counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>St1_S4S</td>
<td>M00529</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>K00376, K02305, K04561</td>
<td>3, 1, 2</td>
</tr>
<tr class="even">
<td>St1_S4M</td>
<td>M00529</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>K00376, K02305, K04561</td>
<td>6, 2, 5</td>
</tr>
<tr class="odd">
<td>St1_S4B</td>
<td>M00529</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>K00376, K02305, K04561</td>
<td>7, 2, 5</td>
</tr>
</tbody>
</table>
<p>All three samples (St1_S4S, St1_S4M, and St1_S4B) show complete denitrification pathways according to both stepwise and pathwise KEGG module criteria, indicating that all required enzymatic steps from nitrate to N‚ÇÇ are represented.</p>
<p>The number of hits for the unique enzymes differs among samples. St1_S4B and St1_S4M show higher hit counts for most of the unique enzymes compared to St1_S4S, suggesting that these functions are represented by more gene transcripts or more abundant RNAs in these samples.</p>
<p>Together, these results suggest that the denitrification pathways is fully expressed in all three samples, but its relative transcription representation appears to be lower in St1_S4S than in St1_S4M and St1_S4B.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Anvi‚Äôo interactive plot</figcaption>
</figure>
</div>
</section>
<section id="kegg-map-of-nitrogen-pathways" class="level2">
<h2 class="anchored" data-anchor-id="kegg-map-of-nitrogen-pathways">KEGG Map of Nitrogen Pathways</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Nitrogen_metabolism_St1_KEGG-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>KEGG map of Nitrogen metabolic pathways. Diagram from anvi‚Äôo and KEGG. In green are the genes present in anvio contig database for Station 1</figcaption>
</figure>
</div>
</section>
<section id="kegg-nitrogen-cycle-map00910" class="level2">
<h2 class="anchored" data-anchor-id="kegg-nitrogen-cycle-map00910">KEGG nitrogen cycle (map00910)</h2>
<p>This is a standard, widely used KO set covering:</p>
<ul>
<li>Nitrification</li>
<li>Denitrification</li>
<li>DNRA</li>
<li>Anammox</li>
<li>Nitrogen fixation</li>
</ul>
<p>Assimilatory pathways</p>
<section id="core-nitrogen-cycle-kos-map00910" class="level3">
<h3 class="anchored" data-anchor-id="core-nitrogen-cycle-kos-map00910">Core nitrogen-cycle KOs (map00910)</h3>
<ul>
<li><p>Nitrogen fixation K02588 nifH K02591 nifD K02586 nifK</p></li>
<li><p>Nitrification K10944 amoA K10945 amoB K10946 amoC K10535 hao</p></li>
<li><p>Assimilatory nitrate reduction K00367 nasA K00360 nirA</p></li>
<li><p>Dissimilatory nitrate reduction (DNRA) K00362 napA K00363 napB K00370 narG K00371 narH K00374 narI K02567 nrfA K02568 nrfH</p></li>
<li><p>Denitrification K00368 nirK K15864 nirS K04561 norB K02305 norC K00376 nosZ</p></li>
<li><p>Anammox K20932 hzsA K20933 hzsB K20934 hzsC K20935 hdh</p></li>
</ul>
</section>
</section>
<section id="tara-oceans-arctic-data-as-reference" class="level2">
<h2 class="anchored" data-anchor-id="tara-oceans-arctic-data-as-reference">Tara Oceans Arctic data as reference</h2>
<section id="rationale-and-overview" class="level3">
<h3 class="anchored" data-anchor-id="rationale-and-overview">Rationale and overview</h3>
<p>As no site-matched metagenomic data were available for these samples, a reference-based approach was adopted using publicly available metagenomic data from the Tara Oceans Arctic expedition (<strong>Station 194</strong>), representing the closest comparable marine Arctic microbial communities currently available.</p>
<p><img src="figures/Tara_Ocean_Artic_St_194_map.png" class="img-fluid" alt="Map of Station 194 of the Tara Oceans Polar Circle expedition in 2013"> 2:45 AM on September 8, 2013 (UTC)</p>
</section>
<section id="station-194---tara-oceans-polar-circle-expedition" class="level3">
<h3 class="anchored" data-anchor-id="station-194---tara-oceans-polar-circle-expedition">Station 194 - Tara Oceans Polar Circle expedition</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BioSamples ID</td>
<td>SAMEA4397903</td>
</tr>
<tr class="even">
<td>ENA Run ID</td>
<td>ERR3589571</td>
</tr>
<tr class="odd">
<td>Date/Time</td>
<td>2013-09-12T03:59:00Z</td>
</tr>
<tr class="even">
<td>Latitude</td>
<td>73.3275</td>
</tr>
<tr class="odd">
<td>Longitude</td>
<td>-168.8142</td>
</tr>
<tr class="even">
<td>Depth</td>
<td>35</td>
</tr>
<tr class="odd">
<td>Layer</td>
<td>DCM</td>
</tr>
<tr class="even">
<td>Size fraction</td>
<td>0.22‚Äì3</td>
</tr>
<tr class="odd">
<td>Region</td>
<td>Arctic Ocean</td>
</tr>
</tbody>
</table>
<p>link to the NCBI SRA (Sequence Read Archive) Run Browser metadata page for a specific run accession (ERR3589571): <a href="https://trace.ncbi.nlm.nih.gov/Traces/index.html?view=run_browser&amp;acc=ERR3589571&amp;display=metadata" class="uri">https://trace.ncbi.nlm.nih.gov/Traces/index.html?view=run_browser&amp;acc=ERR3589571&amp;display=metadata</a></p>
<p>The EBI MGnify overview for analysis MGYA00607610 showing summary metadata and processed metagenomic results for a public datase is here: <a href="https://www.ebi.ac.uk/metagenomics/analyses/MGYA00607610#overview" class="uri">https://www.ebi.ac.uk/metagenomics/analyses/MGYA00607610#overview</a></p>
<p>This strategy enables the detection and quantification of expressed genes that are conserved between Arctic marine microbial communities, while acknowledging that locally specific taxa or gene variants not present in the reference dataset may not be captured.</p>
</section>
<section id="assembly-of-tara-oceans-arctic-metagenomes" class="level3">
<h3 class="anchored" data-anchor-id="assembly-of-tara-oceans-arctic-metagenomes">Assembly of Tara Oceans Arctic metagenomes</h3>
<p>Raw metagenomic reads from the Tara Oceans Arctic expedition were assembled de novo using <strong>MEGAHIT</strong>, which is optimized for large and complex metagenomic datasets. The resulting assembly produced a set of contigs representing microbial genomic fragments present in Arctic marine surface waters.</p>
<p>These contigs were subsequently used as a reference database for read mapping. While the Tara Oceans sampling locations do not overlap geographically with the Chukchi Sea, they provide a comprehensive representation of Arctic marine microbial diversity and metabolic potential, particularly for conserved biogeochemical pathways such as nitrogen cycling.</p>
</section>
<section id="metatranscriptomic-read-processing-and-mapping" class="level3">
<h3 class="anchored" data-anchor-id="metatranscriptomic-read-processing-and-mapping">Metatranscriptomic read processing and mapping</h3>
<p>Quality-filtered metatranscriptomic reads were mapped to the Tara Oceans Arctic contigs using <strong>Bowtie2</strong> with default end-to-end alignment settings. Mapping was performed in paired-end mode to improve alignment specificity. Both concordant and discordant alignments were reported, although downstream analyses focused on concordantly mapped read pairs.</p>
<p><strong>Mapping performance and alignment statistics</strong></p>
<p>Across samples, overall <strong>alignment rates ranged from 15.8% to 27.3%</strong> of paired-end reads mapping to the Tara Oceans Arctic contigs. The majority of reads aligned concordantly exactly once (11‚Äì18%), with a smaller proportion aligning to multiple locations (3‚Äì6%). Discordant alignments accounted for approximately 0.5‚Äì1% of read pairs.</p>
<p>These mapping rates are consistent with expectations for metatranscriptomic datasets mapped to non-site-matched metagenomic references, particularly in polar marine systems where microbial communities exhibit strong spatial structure and strain-level diversity. The observed alignment patterns suggest that a substantial fraction of expressed genes in the Chukchi Sea microbial community are shared with, or closely related to, those represented in the Tara Oceans Arctic metagenomes.</p>
<p><strong>Interpretation and limitations</strong></p>
<p>This reference-based approach enables the identification and relative quantification of expressed genes that are conserved across Arctic marine microbial communities, including key genes involved in nitrogen cycling. However, transcripts derived from locally unique taxa or divergent gene variants absent from the Tara Oceans reference assembly are unlikely to be captured, resulting in an underestimation of total transcript diversity and expression.</p>
<p>Consequently, analyses based on this approach focus on relative expression patterns of nitrogen-cycle gene families represented in the reference dataset, rather than absolute transcript abundances or the absence of specific metabolic pathways. Despite these limitations, the approach provides a robust framework for exploring nitrogen cycling activity in the Chukchi Sea in the absence of site-specific metagenomic data.</p>
</section>
</section>
<section id="downloading-mags-from-station-194" class="level2">
<h2 class="anchored" data-anchor-id="downloading-mags-from-station-194">Downloading MAGs from Station 194</h2>
<p>Using the BioSamples ID (SAMEA4397903) in OMDB repository https://omdb.microbiomics.io/repository/ocean/genome-cols</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>